# 开屏广告品牌标识优化说明

## 更新时间
2025-10-10

## 更新内容

### 背景
为了提升app品牌识别度，在开屏广告显示时，在底部添加明显的品牌标识区域，包含app图标和名称，类似于市面上主流应用的做法。

### 实现方案

#### 1. 自定义品牌视图
在 `GDTAdManager.swift` 中新增 `createBrandView(for:)` 方法，创建一个自定义的底部品牌视图：

**视图组成：**
- **位置**: 屏幕底部，高度120点
- **背景**: 渐变背景，从透明到半透明黑色，确保文字可读性
- **内容**:
  - App图标（50x50点，圆角12点）
  - App名称（"青禾计划"，18号字体，半粗体）
  - 垂直居中布局

**特点：**
- 使用渐变背景，不会遮挡广告内容，同时保证品牌信息可见
- 响应式布局，适配不同屏幕尺寸
- 自动加载app图标，如果没有图标则使用系统叶子图标作为备用

#### 2. 显示逻辑
在显示开屏广告时：
1. 调用腾讯优量汇SDK的 `showFullScreenAd(in:withLogoImage:skip:)` 方法显示全屏广告
2. 创建自定义品牌视图
3. 将品牌视图添加到window的最顶层，确保在广告内容之上显示

#### 3. 清理逻辑
新增 `removeBrandView()` 方法，在以下情况下自动移除品牌视图：
- 广告正常关闭时（`splashAdClosed`）
- 广告展示失败时（`splashAdFail(toPresent:withError:)`）
- 广告显示超时时（15秒超时保护）

移除时使用淡出动画（0.3秒），提供流畅的视觉过渡。

### 技术细节

#### 修改的文件
- `qinghe/ /qinghe/qinghe/GDTAdManager.swift`

#### 新增方法
1. `createBrandView(for: UIWindow) -> UIView`
   - 创建底部品牌标识视图
   - 使用AutoLayout进行布局
   - Tag设置为9999，便于后续查找和移除

2. `removeBrandView()`
   - 通过tag查找品牌视图
   - 使用淡出动画移除
   - 在广告关闭、失败、超时时自动调用

#### 修改的方法
1. `showSplashAd(in:completion:)`
   - 在显示广告时创建并添加品牌视图
   - 在超时处理中添加移除品牌视图的逻辑

2. `splashAdClosed(_:)`
   - 添加移除品牌视图的调用

3. `splashAdFail(toPresent:withError:)`
   - 添加移除品牌视图的调用

### 视觉效果

```
┌──────────────────────┐
│                      │
│                      │
│   广告内容区域        │
│   （全屏显示）        │
│                      │
│                      │
├──────────────────────┤
│   ╭─────────────╮    │  ← 渐变背景开始
│   │             │    │
│   │   App图标   │    │
│   │             │    │
│   ╰─────────────╯    │
│                      │
│     青禾计划         │  ← App名称
│                      │
└──────────────────────┘
```

### 配置说明

#### 可调整参数
在 `createBrandView(for:)` 方法中，以下参数可根据需要调整：

1. **品牌区域高度**: 
   ```swift
   let brandHeight: CGFloat = 120  // 可调整高度
   ```

2. **图标大小**:
   ```swift
   iconImageView.widthAnchor.constraint(equalToConstant: 50)   // 可调整宽度
   iconImageView.heightAnchor.constraint(equalToConstant: 50)  // 可调整高度
   ```

3. **图标圆角**:
   ```swift
   iconImageView.layer.cornerRadius = 12  // 可调整圆角大小
   ```

4. **文字大小**:
   ```swift
   nameLabel.font = UIFont.systemFont(ofSize: 18, weight: .semibold)  // 可调整字体大小和粗细
   ```

5. **渐变颜色**:
   ```swift
   gradientLayer.colors = [
       UIColor.clear.cgColor,
       UIColor.black.withAlphaComponent(0.3).cgColor,
       UIColor.black.withAlphaComponent(0.5).cgColor
   ]
   // 可调整透明度和颜色
   ```

6. **图标与文字间距**:
   ```swift
   nameLabel.topAnchor.constraint(equalTo: iconImageView.bottomAnchor, constant: 8)  // 可调整间距
   ```

### 注意事项

1. **图标资源**: 
   - 优先使用 "AppIcon" 资源
   - 备用 "SplashLogo" 资源
   - 最终备用使用系统叶子图标

2. **兼容性**: 
   - 只在真机上显示（使用 `#if canImport(GDTMobSDK) && !targetEnvironment(simulator)` 条件编译）
   - 模拟器环境下跳过显示

3. **内存管理**: 
   - 使用tag标识视图，便于查找和移除
   - 在广告关闭时自动清理，避免内存泄漏

4. **用户体验**: 
   - 使用渐变背景，不影响广告内容的可见性
   - 移除时使用动画，提供平滑过渡
   - 品牌视图始终在最顶层显示

### 测试建议

1. **真机测试**: 在真机上测试广告显示效果
2. **不同屏幕**: 测试不同尺寸的设备（iPhone SE, iPhone 14, iPhone 14 Pro Max等）
3. **广告场景**: 
   - 测试广告正常显示和关闭
   - 测试广告加载失败的情况
   - 测试广告超时的情况
4. **视觉效果**: 检查品牌标识的位置、大小、颜色是否符合设计要求

### 后续优化建议

1. **动态配置**: 可以考虑将品牌标识的样式参数配置化，便于后台动态调整
2. **品牌信息**: 可以添加更多品牌信息，如slogan等
3. **多语言**: 考虑app名称的多语言支持
4. **深浅色模式**: 可以根据系统深浅色模式调整颜色方案

