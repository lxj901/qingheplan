# 会员中心已开通会员 UI 更新说明

## 📋 更新概述

为会员中心页面添加了已开通会员的状态展示 UI，当用户已经是会员时，会在页面顶部显示一个精美的会员状态卡片。

## ✨ 新增功能

### 1. 会员状态卡片

在 `MembershipCenterView.swift` 中新增了 `activeMembershipCard` 视图组件，包含以下信息：

#### 显示内容：
- **会员图标**：带有皇冠图标的圆形徽章，使用渐变色
- **会员名称**：显示当前会员套餐名称（如"连续包月会员"）
- **会员状态**：显示"会员服务生效中"的标识
- **到期时间**：格式化显示会员到期日期（如"2025年11月29日"）
- **剩余天数**：显示剩余天数，少于7天时用红色警示
- **自动续费状态**：显示是否开启自动续费（绿色表示已开启，橙色表示已关闭）
- **购买渠道**：显示会员来源（Apple 内购、微信支付、支付宝等）

#### 设计特点：
- 顶部装饰条：使用小圆点组成的装饰线
- 渐变背景：白色到浅米色的渐变
- 渐变边框：金色渐变描边
- 阴影效果：柔和的投影增强立体感
- 图标系统：每个信息项都配有对应的 SF Symbol 图标

### 2. 条件显示逻辑

根据用户会员状态，动态调整页面显示内容：

#### 已开通会员时：
- ✅ 显示会员状态卡片
- ❌ 隐藏套餐选择区域（`horizontalPricingSection`）
- ❌ 隐藏底部保障信息（`guaranteeSection`）
- ✅ 显示会员特权展示
- ✅ 显示产品愿景说明

#### 未开通会员时：
- ❌ 隐藏会员状态卡片
- ✅ 显示套餐选择区域（标题："选择套餐"）
- ✅ 显示底部保障信息
- ✅ 显示会员特权展示
- ✅ 显示产品愿景说明

判断条件：
- `viewModel.isActiveMember` 为 `true`
- 即：`status?.hasMembership == true && status?.status == "active"`

## 🎨 UI 设计细节

### 颜色方案
- **主色调**：金棕色系（与整体设计保持一致）
  - 主金色：`Color(red: 0.75, green: 0.55, blue: 0.35)`
  - 深金色：`Color(red: 0.65, green: 0.45, blue: 0.25)`
- **文字颜色**：
  - 标题：`Color(red: 0.2, green: 0.15, blue: 0.1)`
  - 副标题：`Color(red: 0.5, green: 0.4, blue: 0.3)`
- **状态颜色**：
  - 绿色：自动续费已开启
  - 橙色：自动续费已关闭
  - 红色：剩余天数不足7天

### 布局结构
```
会员状态卡片
├── 顶部装饰条（20个小圆点）
└── 主体内容
    ├── 会员标识区
    │   ├── 皇冠图标（56x56圆形）
    │   └── 会员名称 + 状态标签
    ├── 分隔线
    └── 会员信息区
        ├── 到期时间
        ├── 剩余天数
        ├── 自动续费状态
        └── 购买渠道
```

## 📱 数据来源

会员状态数据来自 `MembershipViewModel` 中的 `status` 属性：

```swift
@Published var status: MembershipStatusData?
```

### 使用的字段：
- `currentPlan?.planName`：会员套餐名称
- `endDate`：到期时间
- `daysRemaining`：剩余天数
- `autoRenew`：自动续费状态
- `source`：购买渠道

## 🔧 辅助函数

### 1. `formatExpiryDate(_ dateString: String) -> String`
格式化 ISO 8601 日期字符串为中文日期格式（如"2025年11月29日"）

支持的日期格式：
- ISO 8601 with fractional seconds
- `yyyy-MM-dd'T'HH:mm:ss.SSSZ`

### 2. `sourceIcon(_ source: String) -> String`
根据购买渠道返回对应的 SF Symbol 图标名称：
- `apple` → `apple.logo`
- `wechat` → `message.fill`
- `alipay` → `creditcard.fill`
- `admin` → `person.badge.key.fill`
- 其他 → `bag.fill`

### 3. `sourceName(_ source: String) -> String`
将购买渠道代码转换为中文名称：
- `apple` → "Apple 内购"
- `wechat` → "微信支付"
- `alipay` → "支付宝"
- `admin` → "管理员赠送"

## 🧪 预览支持

添加了两个 SwiftUI 预览：

### 1. 已开通会员预览
```swift
#Preview("会员中心 - 已开通会员")
```
模拟已开通会员状态，展示完整的会员状态卡片

### 2. 未开通会员预览
```swift
#Preview("会员中心 - 未开通会员")
```
模拟未开通会员状态，不显示会员状态卡片

## 📝 代码位置

所有更改都在以下文件中：
- `qinghe/ /qinghe/qinghe/MembershipCenterView.swift`

### 主要修改：
1. **第 33-71 行**：在 `body` 中添加条件显示逻辑
   - 已开通会员：显示会员状态卡片，隐藏套餐选择和底部保障
   - 未开通会员：隐藏会员状态卡片，显示套餐选择和底部保障
2. **第 189-441 行**：新增 `activeMembershipCard` 视图和辅助函数
3. **第 1770-1817 行**：添加 SwiftUI 预览

## ✅ 编译状态

项目已成功编译，无错误：
```
** BUILD SUCCEEDED **
```

## 🎯 使用场景

### 场景 1：用户首次打开会员中心
- **未开通会员**：显示套餐选择、会员特权、产品愿景和底部保障
- **已开通会员**：仅显示会员状态卡片、会员特权和产品愿景，不显示套餐选择

### 场景 2：用户购买会员后
- 购买成功后，`viewModel.load()` 会刷新状态
- 会员状态卡片自动显示
- 套餐选择区域自动隐藏
- 页面焦点转移到会员信息展示

### 场景 3：会员即将到期
- 剩余天数少于7天时，天数显示为红色
- 提醒用户及时续费
- 用户可以通过其他入口（如设置）进行续费操作

### 场景 4：自动续费管理
- 清晰显示自动续费状态
- 用户可以了解当前续费设置
- 如需管理订阅，可前往系统设置

## 🔄 后续优化建议

1. **添加续费入口**：为已开通会员提供续费/升级的入口（如在设置页面或会员状态卡片中）
2. **添加动画效果**：卡片出现时添加淡入和滑动动画
3. **添加点击交互**：点击卡片可以查看更详细的会员信息或跳转到订阅管理
4. **添加会员权益快捷入口**：在卡片中添加快捷按钮，直接使用会员特权功能
5. **优化日期显示**：添加相对时间显示（如"还有30天到期"）
6. **到期提醒**：会员即将到期时，在卡片中显示续费提醒和快捷续费按钮

## 📸 效果展示

会员状态卡片包含：
- ✅ 精美的视觉设计
- ✅ 完整的会员信息
- ✅ 清晰的状态指示
- ✅ 统一的设计风格
- ✅ 良好的用户体验

---

**更新时间**：2025-10-29  
**更新内容**：为会员中心页面添加已开通会员的 UI 展示

