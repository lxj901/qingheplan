# 设置功能优化说明

## 修改日期
2025-10-09

## 修改内容

### 1. 删除背景设置模块

#### 删除的内容：
- **设置菜单项**：删除了"个性化设置"分组中的"背景设置"选项
- **导航目标**：删除了 `SettingsDestination.backgroundSettings` 枚举值
- **导航处理**：删除了背景设置的导航跳转和点击处理逻辑
- **视图结构**：完全删除了以下内容：
  - `BackgroundSettingsView` 结构体
  - `ColorSchemeOption` 枚举
  - `ThemeManager` 类
- **App引用**：删除了 `qingheApp.swift` 中对 `ThemeManager` 的引用

#### 影响范围：
- `qinghe/ /qinghe/qinghe/MessagesView.swift`
- `qinghe/ /qinghe/qinghe/qingheApp.swift`

### 2. 字体大小功能全局化

#### 现状确认：
- **FontManager** 已经是全局单例模式（`FontManager.shared`）
- 提供了 `.dynamicFont()` 扩展方法，可在整个 app 的任何视图中使用
- 使用 `@Published` 属性，支持实时更新

#### 使用方法：
```swift
// 在任何视图中使用
Text("示例文本")
    .dynamicFont(.body)

Text("标题")
    .dynamicFont(.title2)
```

#### 支持的字体样式：
- 标题类：`.largeTitle`, `.title1`, `.title2`, `.title3`, `.headline`
- 正文类：`.body`, `.bodyMedium`, `.callout`, `.subheadline`
- 辅助类：`.footnote`, `.caption1`, `.caption2`
- 数字类：`.numberLarge`, `.numberMedium`, `.numberSmall`

### 3. 多语言功能全局化

#### 实施的改进：
1. **改为单例模式**：将 `LocalizationManager` 从普通类改为单例（`LocalizationManager.shared`）
2. **统一实例管理**：所有使用 `LocalizationManager` 的地方都改为使用 `.shared` 实例
3. **添加便捷方法**：新增 View 扩展，方便在其他视图中使用

#### 修改的文件：
- `qinghe/ /qinghe/qinghe/MessagesView.swift`（主要修改）
- `qinghe/ /qinghe/qinghe/LocalizationTest.swift`

#### 使用方法：

**方法1：通过管理器调用**
```swift
@StateObject private var localizationManager = LocalizationManager.shared

Text(localizationManager.localizedString(key: "settings"))
```

**方法2：通过扩展方法调用**
```swift
// 可以在任何视图中直接调用
let text = localizedString("settings")
```

#### 支持的语言：
- 简体中文 (zh-Hans)
- 繁体中文 (zh-Hant)
- 英文 (en)
- 日文 (ja)
- 韩文 (ko)

## 技术细节

### 单例模式的优势
1. **全局一致性**：确保整个应用使用同一个配置实例
2. **自动同步**：修改设置后，所有使用该实例的视图都会自动更新
3. **持久化存储**：设置自动保存到 UserDefaults，应用重启后保持

### 实时更新机制
- 使用 `@Published` 属性包装器
- 结合 `ObservableObject` 协议
- 所有订阅者自动响应变化

## 使用建议

### 字体大小
- 在新开发的视图中，统一使用 `.dynamicFont()` 修饰符
- 避免硬编码字体大小
- 让用户可以根据需要调整整个应用的字体大小

### 多语言
- 在新增界面文本时，添加到 `LocalizedStrings` 的所有语言映射中
- 使用 `LocalizationManager.shared.localizedString(key:)` 获取本地化字符串
- 确保所有用户可见文本都支持多语言

## 后续建议

1. **渐进式应用字体管理**：在后续开发中，逐步将现有视图的字体改为使用 `.dynamicFont()`
2. **扩展多语言覆盖**：将更多页面的文本添加到多语言系统中
3. **测试验证**：在不同语言和字体大小设置下测试应用的显示效果

